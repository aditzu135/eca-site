<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>For Eca ‚ù§Ô∏è</title>
<style>
body {
  margin:0;
  background:#0d0d0d;
  color:#f5f5f5;
  font-family:Georgia, serif;
  text-align:center;
}

/* LOGIN SCREEN */
#gate {
  width:100%;
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:#1a1a1a;
}
#gate h1 {
  font-size:40px;
  color:#ffd166;
  margin-bottom:20px;
}
#passInput {
  padding:12px;
  width:200px;
  font-size:18px;
  text-align:center;
  border:2px solid #ffd166;
  background:#0b0b0b;
  color:white;
  border-radius:6px;
}
#enterBtn {
  margin-top:15px;
  padding:10px 20px;
  font-size:18px;
  background:#5a189a;
  border:0;
  color:white;
  border-radius:6px;
  cursor:pointer;
}
#enterBtn:hover { background:#7b2cbf; }
#error { color:#ff4444; margin-top:10px; font-size:16px; }

/* MAIN SCREEN */
#mainScreen { display:none; padding:30px; }
h1.main { font-size:36px; color:#ff6f61; margin-bottom:10px; }
#countdown { font-size:24px; color:#ffd166; margin-bottom:30px; }
button.noteBtn {
  padding:12px 20px;
  font-size:18px;
  margin:10px;
  border-radius:8px;
  border:none;
  background:#ff4f81;
  color:white;
  cursor:pointer;
}
button.noteBtn:hover { background:#ff2f5a; }
#button.playBtn {}
button.playBtn {
  padding:12px 20px;
  font-size:18px;
  margin:10px;
  border-radius:8px;
  border:none;
  background:#aee7ff; /* baby blue */
  color:#002b36;
  cursor:pointer;
}
button.playBtn:hover { background:#89cfff; }
#embeddedUI { display:block; }
.embedded {
  width:320px;
  margin:20px auto;
  padding:16px;
  border-radius:16px;
  background: linear-gradient(135deg,#ff9aa2 0%, #ff6bcb 50%, #ffb3d9 100%);
  color:#2b002b;
  box-shadow: 0 8px 24px rgba(255,77,166,0.18);
  text-align:center;
  transform: translateY(0);
}
.embedded .heartsRow { font-size:20px; margin-bottom:8px; }
.embedded #trackName { font-weight:bold; margin-bottom:10px; color:#2b002b; }
.embedded .playBtn { background:#ff4f81; color:white; padding:10px 16px; border-radius:10px; }
.embedded .playBtn:hover { background:#ff2f5a; }
.playerBox {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  margin-top:12px;
  background: rgba(255,255,255,0.9);
  padding:10px 14px;
  border-radius:999px;
  width:260px;
  margin-left:auto;
  margin-right:auto;
}
.audio-hide { display: none !important; }
/* Force-hide native audio controls and ensure embedded UI is centered on the live site */
audio#player { display: none !important; }
#embeddedUI { display: block !important; margin: 18px auto !important; }
.embedded { margin-left: auto !important; margin-right: auto !important; }
.playBtn.small { padding:8px 12px; border-radius:12px; font-size:16px; background:#ff6b9a; }
.playBtn.small:hover { background:#ff4f81; }
#loveNote {
  margin-top:20px;
  font-size:20px;
  color:#ffd166;
  opacity:0;
  transition: opacity 0.6s;
  max-width:80%;
  margin-left:auto;
  margin-right:auto;
}

/* Hearts animation */
.heart {
  position:absolute;
  font-size:24px;
  color:#ff2f5a;
  animation: float 3s ease-in forwards;
  pointer-events:none;
}
@keyframes float {
  0% { transform: translateY(0) scale(1); opacity:1; }
  100% { transform: translateY(-200px) scale(1.5); opacity:0; }
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="gate">
  <h1>üîí Access for My Crowned Heart</h1>
  <input id="passInput" type="password" placeholder="Enter the Oath...">
  <button id="enterBtn" onclick="unlock()">Enter</button>
  <div id="error"></div>
</div>

<!-- MAIN SCREEN -->
<div id="mainScreen">
  <h1 class="main">üíñ Welcome, My Dearest Light üíñ</h1>
  <div id="countdown">‚è≥ Calculating‚Ä¶</div>
  <p>Click the buttons to receive a message from your King üëë</p>
  <button class="noteBtn" onclick="showNote()">Reveal a Love Note</button>
  <button class="playBtn" id="playBtn" onclick="handlePlayClick()">Play Love Songs</button>
  <div id="loveNote"></div>
  <!-- Embedded cute player UI (shown when playlist is available locally or as fallback) -->
  <div id="embeddedUI" class="embedded" style="display:none;">
    <div class="heartsRow">‚ù§Ô∏è ‚ù§Ô∏è‚Äçüî• ‚ù§Ô∏è</div>
    <div id="trackName">Ready to play</div>
    <button id="shuffleBtn" class="playBtn">Shuffle Play</button>
    <div class="playerBox" id="playerBox" style="display:none;">
      <button id="playPauseBtn" class="playBtn small">‚ñ∂</button>
      <span id="time" style="margin-left:10px; color:#2b002b;">0:00 / 0:00</span>
    </div>
  </div>
  <input type="file" id="folderPicker" webkitdirectory directory multiple style="display:none">
  <audio id="player" controls style="display:none; margin-top:12px;"></audio>
</div>

<script>
// ===== PASSWORD CHECK =====
function unlock() {
  const pass = document.getElementById("passInput").value;
  if(pass === "2811") {
    document.getElementById("gate").style.display="none";
    document.getElementById("mainScreen").style.display="block";
    startCountdown();
  } else {
    document.getElementById("error").textContent = "‚ö†Ô∏è Wrong Oath. The King rejects liars.";
  }
}

// ===== COUNTDOWN TIMER =====
function startCountdown() {
  const startDate = new Date("2023-11-28T00:00:00");
  const countdownEl = document.getElementById("countdown");

  function update() {
    const now = new Date();
    const diff = now - startDate;

    const days = Math.floor(diff / (1000*60*60*24));
    const hours = Math.floor((diff / (1000*60*60)) % 24);
    const minutes = Math.floor((diff / (1000*60)) % 60);
    const seconds = Math.floor((diff / 1000) % 60);

    countdownEl.textContent = `‚è≥ ${days} days, ${hours}h ${minutes}m ${seconds}s of our love üíñ`;
  }
  update();
  setInterval(update, 1000);
}

// ===== RANDOMIZED KING LOVE NOTES =====
const loveNotes = [
  "I am sworn to love my people equally, yet you are the one for whom I would see my kingdom turned to ash.",
  "My crown is forged of gold, yet your name is the only jewel it cannot carry without trembling.",
  "To protect my realm is duty. To protect you, my truth, is instinct deeper than blood.",
  "Armies obey my voice, but my heart bows only to yours.",
  "Should destiny ever demand sacrifice, let it take my throne, my breath, my name‚Äîyet never you.",
  "I do not kneel to gods nor kings, but your presence bends my soul into worship.",
  "The world calls me sovereign. You call me yours‚Äîand that is the only title that matters.",
  "I rule with iron command, yet you, my dearest light, rule me with a whisper.",
  "My blade defends a kingdom, but my heart defends only you.",
  "Peace is a luxury I afford my kingdom. Madness is the love I reserve for you.",
  "If ever I must choose between justice and your smile, then let justice perish.",
  "Your absence is the only enemy I cannot conquer.",
  "I could win a thousand wars and still feel defeated without your warmth beside me.",
  "Your touch could turn battlefields into gardens, and my rage into devotion.",
  "Let the heavens envy us, for even eternity cannot unbind what our hearts declared in silence.",
  "If fate tried to steal you from me, I would rewrite fate with fire and oath.",
  "I am feared by many, but humbled only by your existence.",
  "The throne gives me power; you give it purpose.",
  "Your name is carved in the vault of my heart deeper than any crown could rest upon my head.",
  "Without you, my kingdom is only land. But with you, even ashes would feel like home."
];

function showNote() {
  const note = document.getElementById("loveNote");
  const random = loveNotes[Math.floor(Math.random() * loveNotes.length)];
  note.textContent = random;
  note.style.opacity = 1;
  createHearts();
}

// ===== HEARTS ANIMATION =====
function createHearts() {
  const heart = document.createElement("div");
  heart.classList.add("heart");
  heart.textContent = "‚ù§Ô∏è";
  heart.style.left = Math.random() * (window.innerWidth - 40) + "px";
  // start from near the bottom so the float animation moves upward
  heart.style.top = (window.innerHeight - 120 + Math.random() * 60) + "px";
  heart.style.fontSize = (20 + Math.random() * 30) + "px";
  // vary animation duration for natural effect
  heart.style.animationDuration = (2.5 + Math.random() * 1.5) + "s";
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 3000);
}

// ===== PLAYLIST / AUDIO PLAYER =====
let playlist = [];
const player = document.getElementById('player');
const folderPicker = document.getElementById('folderPicker');
// Embedded fallback for when the page is opened via file:// (fetch may fail)
const embeddedPlaylist = [
  'material/driver.mp3',
  'material/iwby.mp3',
  'material/nebun.mp3',
  'material/sweater.mp3',
  'material/ifnotforyou.mp3'
];
const embeddedUI = document.getElementById('embeddedUI');
const trackNameEl = document.getElementById('trackName');
const shuffleBtn = document.getElementById('shuffleBtn');
const playerBox = document.getElementById('playerBox');
const playPauseBtn = document.getElementById('playPauseBtn');
const timeEl = document.getElementById('time');

async function tryLoadPlaylistJson() {
  try {
    const resp = await fetch('material/playlist.json', {cache: 'no-store'});
    if(!resp.ok) throw new Error('no playlist');
    const list = await resp.json();
    if(Array.isArray(list) && list.length) {
      playlist = list.map(p => 'material/' + p);
      return true;
    }
  } catch (e) {
    // If fetch fails (for example when using file://), fall back to embedded list if available
    if (Array.isArray(embeddedPlaylist) && embeddedPlaylist.length) {
      playlist = embeddedPlaylist.slice();
      return true;
    }
    return false;
  }
  return false;
}

function handlePlayClick() {
  // If we already have playlist entries, play immediately
  if (playlist.length > 0) {
    playRandomFromPlaylist();
    return;
  }

  // Try loading a playlist manifest (works if served via HTTP)
  tryLoadPlaylistJson().then(found => {
    if (found && playlist.length > 0) {
      showEmbeddedUI();
      playRandomFromPlaylist();
      return;
    }

    // Fallback: ask user to select the folder (works locally in modern browsers)
    document.getElementById('error').textContent = 'Please select the \"material\" folder (or add a file named material/playlist.json listing filenames).';
    // If embedded playlist is present, show the cute UI and play from embedded list instead of immediately opening folder
    if (Array.isArray(embeddedPlaylist) && embeddedPlaylist.length) {
      playlist = embeddedPlaylist.slice();
      showEmbeddedUI();
      playRandomFromPlaylist();
      return;
    }
    folderPicker.click();
  });
}

function playRandomFromPlaylist() {
  if (!playlist || playlist.length === 0) {
    document.getElementById('error').textContent = 'No songs found to play.';
    return;
  }
  const idx = Math.floor(Math.random() * playlist.length);
  const src = playlist[idx];
  player.src = src;
  // hide native controls and use custom playerBox
  try { player.controls = false; } catch (e) {}
  if (playerBox) playerBox.style.display = 'flex';
  // Update displayed track name (strip path and extension)
  try {
    const raw = decodeURIComponent(src.split('/').pop());
    const name = raw.replace(/\.[^/.]+$/, '');
    if (trackNameEl) trackNameEl.textContent = name;
  } catch (e) {}
  player.play().catch(() => {
    // autoplay may be blocked; controls are shown so user can press play
  });
}

function handleFolderFiles(e) {
  const files = Array.from(e.target.files || []);
  const audios = files.filter(f => f.type.startsWith('audio') || /\.(mp3|wav|ogg|m4a|flac|aac)$/i.test(f.name));
  if (audios.length === 0) {
    document.getElementById('error').textContent = 'No audio files found in the selected folder.';
    return;
  }
  // Create object URLs for local files
  playlist = audios.map(f => URL.createObjectURL(f));
  document.getElementById('error').textContent = '';
  playRandomFromPlaylist();
}

folderPicker.addEventListener('change', handleFolderFiles);
// Embedded UI actions
function showEmbeddedUI() {
  if (embeddedUI) embeddedUI.style.display = 'block';
}
function hideEmbeddedUI() {
  if (embeddedUI) embeddedUI.style.display = 'none';
}
if (shuffleBtn) shuffleBtn.addEventListener('click', playRandomFromPlaylist);
// Play/pause and time handling for custom UI
if (playPauseBtn) {
  playPauseBtn.addEventListener('click', () => {
    if (!player.src) return playRandomFromPlaylist();
    if (player.paused) player.play(); else player.pause();
  });
}
player.addEventListener('timeupdate', () => {
  if (!timeEl) return;
  const fmt = t => {
    if (!isFinite(t)) return '0:00';
    const m = Math.floor(t/60);
    const s = Math.floor(t%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  };
  timeEl.textContent = `${fmt(player.currentTime)} / ${fmt(player.duration)}`;
});
player.addEventListener('play', () => { if (playPauseBtn) playPauseBtn.textContent = '‚ùö‚ùö'; });
player.addEventListener('pause', () => { if (playPauseBtn) playPauseBtn.textContent = '‚ñ∂'; });
player.addEventListener('ended', () => { playRandomFromPlaylist(); });
</script>

</body>
</html>
